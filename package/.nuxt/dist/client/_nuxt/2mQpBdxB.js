import{d as $,r as u,p as T,a as G,c as n,e as b,f as p,i,j as l,k as r,l as d,q as J,m as k,s as K,F as h,u as _,v as Q,_ as W}from"./CCcdX0hl.js";const X={class:"d-flex flex-wrap align-center gap-4"},Y={class:"d-flex flex-wrap align-center gap-2"},ee={class:"text-h4 font-weight-bold"},te={class:"text-body-1"},oe=$({__name:"PostalCodeDeliveries",setup(le){const f=u(!0),g=u(""),m=u([]),S=u(""),c=u("Tutte"),z=["08:00-10:00","10:00-12:00","12:00-14:00","14:00-16:00","16:00-18:00","18:00-20:00"],D=T(()=>c.value==="Tutte"),y=T(()=>D.value?m.value.map(e=>{const t=e.deliveries.reduce((a,s)=>a+s.onTime,0);return{postalCode:e.postalCode,zone:e.zone,deliveryCount:e.totalDeliveries,onTimeCount:t,onTimePercentage:e.totalDeliveries>0?t/e.totalDeliveries*100:0,averageTime:e.averageTime}}).sort((e,t)=>t.deliveryCount-e.deliveryCount):m.value.map(e=>{const t=e.deliveries.find(a=>a.timeSlot===c.value)||{count:0,onTime:0};return{postalCode:e.postalCode,zone:e.zone,deliveryCount:t.count,onTimeCount:t.onTime,onTimePercentage:t.count>0?t.onTime/t.count*100:0,averageTime:e.averageTime,timeSlot:c.value}}).sort((e,t)=>t.deliveryCount-e.deliveryCount)),v=T(()=>{const e=y.value.reduce((a,s)=>(a.totalDeliveries+=s.deliveryCount,a.onTime+=s.onTimeCount,a),{totalDeliveries:0,onTime:0}),t=m.value.length>0?Math.round(m.value.reduce((a,s)=>a+s.averageTime,0)/m.value.length):0;return{totalDeliveries:e.totalDeliveries,onTime:e.onTime,late:e.totalDeliveries-e.onTime,averageTime:t,onTimePercentage:e.totalDeliveries>0?e.onTime/e.totalDeliveries*100:0}}),w=T(()=>{const e=[{title:"CAP",key:"postalCode",align:"start"},{title:"Zona",key:"zone"}];return D.value?[...e,{title:"Totale Consegne",key:"deliveryCount",align:"center"},{title:"Puntualità",key:"onTimePercentage",align:"center"},{title:"Tempo Medio",key:"averageTime",align:"end",class:"d-none d-md-table-cell"}]:[...e,{title:"Fascia Oraria",key:"timeSlot",class:"d-none d-sm-table-cell"},{title:"Consegne",key:"deliveryCount",align:"center"},{title:"Puntualità",key:"onTimePercentage",align:"center"},{title:"Tempo Medio",key:"averageTime",align:"end",class:"d-none d-md-table-cell"}]}),x=e=>e>90?"success":e>75?"warning":"error",V=()=>{},F=()=>alert("Funzionalità PDF in sviluppo"),M=()=>{S.value=new Date().toLocaleString("it-IT")};return G(()=>{setTimeout(()=>{m.value=[{postalCode:"20121",zone:"Milano Centro",deliveries:[{timeSlot:"08:00-10:00",count:15,onTime:14},{timeSlot:"10:00-12:00",count:22,onTime:20},{timeSlot:"12:00-14:00",count:18,onTime:17},{timeSlot:"14:00-16:00",count:12,onTime:11},{timeSlot:"16:00-18:00",count:20,onTime:19},{timeSlot:"18:00-20:00",count:25,onTime:23}],totalDeliveries:112,averageTime:22},{postalCode:"20122",zone:"Milano Centro-Sud",deliveries:[{timeSlot:"08:00-10:00",count:12,onTime:11},{timeSlot:"10:00-12:00",count:18,onTime:17},{timeSlot:"12:00-14:00",count:15,onTime:14},{timeSlot:"14:00-16:00",count:10,onTime:9},{timeSlot:"16:00-18:00",count:16,onTime:15},{timeSlot:"18:00-20:00",count:20,onTime:18}],totalDeliveries:91,averageTime:25},{postalCode:"20123",zone:"Milano Centro-Ovest",deliveries:[{timeSlot:"08:00-10:00",count:10,onTime:9},{timeSlot:"10:00-12:00",count:15,onTime:14},{timeSlot:"12:00-14:00",count:12,onTime:11},{timeSlot:"14:00-16:00",count:8,onTime:7},{timeSlot:"16:00-18:00",count:14,onTime:13},{timeSlot:"18:00-20:00",count:18,onTime:16}],totalDeliveries:77,averageTime:24},{postalCode:"20124",zone:"Milano Centro-Est",deliveries:[{timeSlot:"08:00-10:00",count:14,onTime:13},{timeSlot:"10:00-12:00",count:20,onTime:18},{timeSlot:"12:00-14:00",count:16,onTime:15},{timeSlot:"14:00-16:00",count:11,onTime:10},{timeSlot:"16:00-18:00",count:18,onTime:17},{timeSlot:"18:00-20:00",count:22,onTime:20}],totalDeliveries:101,averageTime:23},{postalCode:"20125",zone:"Milano Nord",deliveries:[{timeSlot:"08:00-10:00",count:8,onTime:7},{timeSlot:"10:00-12:00",count:12,onTime:11},{timeSlot:"12:00-14:00",count:10,onTime:9},{timeSlot:"14:00-16:00",count:6,onTime:5},{timeSlot:"16:00-18:00",count:11,onTime:10},{timeSlot:"18:00-20:00",count:15,onTime:13}],totalDeliveries:62,averageTime:28}],S.value=new Date().toLocaleString("it-IT"),f.value=!1},1e3)}),(e,t)=>{const a=n("v-spacer"),s=n("v-select"),A=n("v-btn"),C=n("v-list-item"),N=n("v-list"),B=n("v-menu"),E=n("v-progress-linear"),P=n("v-card"),I=n("v-col"),L=n("v-row"),O=n("v-card-item"),U=n("v-divider"),H=n("v-text-field"),j=n("v-skeleton-loader"),q=n("v-chip"),R=n("v-data-table");return p(),b(P,null,{default:i(()=>[l(O,{class:"pa-4 pa-md-6"},{default:i(()=>[r("div",X,[t[5]||(t[5]=r("div",null,[r("h2",{class:"text-h5"},"Analisi Consegne per CAP"),r("p",{class:"text-subtitle-1 text-medium-emphasis"},"Dati aggregati per codice postale e fasce orarie")],-1)),l(a),r("div",Y,[l(s,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),items:["Tutte",...z],label:"Fascia Oraria",density:"compact",variant:"outlined","hide-details":"",style:{"min-width":"160px"}},null,8,["modelValue","items"]),l(B,null,{activator:i(({props:o})=>[l(A,J({icon:"mdi-dots-vertical"},o,{title:"Altre azioni"}),null,16)]),default:i(()=>[l(N,null,{default:i(()=>[l(C,{onClick:M,"prepend-icon":"mdi-refresh"},{default:i(()=>t[2]||(t[2]=[d("Aggiorna")])),_:1}),l(C,{onClick:V,"prepend-icon":"mdi-file-delimited"},{default:i(()=>t[3]||(t[3]=[d("Esporta CSV")])),_:1}),l(C,{onClick:F,"prepend-icon":"mdi-file-pdf-box"},{default:i(()=>t[4]||(t[4]=[d("Esporta PDF")])),_:1})]),_:1})]),_:1})])]),l(L,{class:"mt-4"},{default:i(()=>[(p(!0),k(h,null,K([{label:"Totale Consegne",value:v.value.totalDeliveries,color:"primary"},{label:"Puntuali",value:v.value.onTime,color:"success"},{label:"In Ritardo",value:v.value.late,color:"error"},{label:"Puntualità %",value:v.value.onTimePercentage,isPercentage:!0}],(o,Z)=>(p(),b(I,{key:Z,cols:"12",sm:"6",md:"3"},{default:i(()=>[l(P,{variant:"tonal",color:o.color,class:"d-flex flex-column pa-4 text-center h-100"},{default:i(()=>[r("div",ee,_(o.isPercentage?`${o.value.toFixed(1)}%`:o.value),1),r("div",te,_(o.label),1),o.isPercentage?(p(),k(h,{key:0},[l(a),l(E,{"model-value":o.value,color:x(o.value),height:"6",rounded:"",class:"mt-2"},null,8,["model-value","color"])],64)):Q("",!0)]),_:2},1032,["color"])]),_:2},1024))),128))]),_:1})]),_:1}),l(U),l(H,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=o=>g.value=o),label:"Cerca per CAP o zona...","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"]),l(R,{headers:w.value,items:y.value,search:g.value,loading:f.value,"item-value":"postalCode",class:"elevation-0"},{loading:i(()=>[l(j,{type:"table-row@5"})]),"item.onTimePercentage":i(({value:o})=>[l(q,{color:x(o),size:"small",class:"font-weight-bold"},{default:i(()=>[d(_(o.toFixed(1))+"% ",1)]),_:2},1032,["color"])]),"item.averageTime":i(({value:o})=>[d(_(o)+" min ",1)]),"no-data":i(()=>t[6]||(t[6]=[r("div",{class:"pa-4 text-center"},"Nessun dato trovato.",-1)])),_:1},8,["headers","items","search","loading"])]),_:1})}}}),ie=W(oe,[["__scopeId","data-v-780abc11"]]);export{ie as P};
