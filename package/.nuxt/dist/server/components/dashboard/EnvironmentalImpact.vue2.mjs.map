{"version":3,"file":"EnvironmentalImpact.vue2.mjs","sources":["../../../../../components/dashboard/EnvironmentalImpact.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue';\n\n// 1. TypeScript Interface per i dati\ninterface EnvironmentalData {\n  month: string;\n  year: number;\n  co2Saved: number;\n  plasticSaved: number;\n  waterSaved: number;\n  localProducts: number;\n  organicProducts: number;\n  deliveryDistance: number;\n  deliveryEmissions: number;\n}\n\n// 2. Stato reattivo\nconst isLoading = ref(true);\nconst search = ref('');\nconst environmentalData = ref<EnvironmentalData[]>([]);\nconst lastUpdate = ref('');\n// Aggiungiamo un filtro per anno per maggiore flessibilità\nconst years = computed(() => [...new Set(environmentalData.value.map(d => d.year))]);\nconst selectedYear = ref(new Date().getFullYear());\n\n\n// 3. Logica di calcolo (Computed Properties)\n// Filtra i dati per anno prima di passarli alla tabella\nconst filteredData = computed(() => \n    environmentalData.value.filter(d => d.year === selectedYear.value)\n);\n\n// 4. Configurazione dei KPI: IL CUORE DELLA SEMPLIFICAZIONE\n// Definiamo ogni metrica una sola volta. Il template si adatterà automaticamente.\nconst kpiConfig = [\n  { key: 'co2Saved', label: 'CO2 Risparmiata', unit: 'kg', icon: 'mdi-molecule-co2', color: 'success', type: 'sum' },\n  { key: 'plasticSaved', label: 'Plastica Risparmiata', unit: 'kg', icon: 'mdi-recycle-variant', color: 'info', type: 'sum' },\n  { key: 'waterSaved', label: 'Acqua Risparmiata', unit: 'L', icon: 'mdi-water-outline', color: 'primary', type: 'sum' },\n  { key: 'localProducts', label: 'Prodotti Locali', unit: '%', icon: 'mdi-map-marker-outline', color: 'teal', type: 'avg' },\n  { key: 'organicProducts', label: 'Prodotti Biologici', unit: '%', icon: 'mdi-leaf-outline', color: 'green', type: 'avg' },\n  { key: 'deliveryDistance', label: 'Distanza Consegne', unit: 'km', icon: 'mdi-truck-outline', color: 'warning', type: 'sum' },\n  { key: 'deliveryEmissions', label: 'Emissioni Consegne', unit: 'kg CO₂', icon: 'mdi-factory', color: 'error', type: 'sum' },\n];\n\n// Calcoliamo dinamicamente i valori dei KPI in base alla configurazione\nconst kpiTotals = computed(() => {\n    const data = environmentalData.value; // Calcola sempre sul totale\n    if (data.length === 0) return [];\n    \n    return kpiConfig.map(kpi => {\n        let value = 0;\n        if (kpi.type === 'sum') {\n            value = data.reduce((acc, item) => acc + item[kpi.key as keyof EnvironmentalData], 0);\n        } else if (kpi.type === 'avg') {\n            value = data.reduce((acc, item) => acc + item[kpi.key as keyof EnvironmentalData], 0) / data.length;\n        }\n        return { ...kpi, value };\n    });\n});\n\n// 5. Headers per la v-data-table\nconst headers = [\n  { title: 'Mese', key: 'month', align: 'start' },\n  { title: 'CO₂ Risparm. (kg)', key: 'co2Saved', align: 'end' },\n  { title: 'Plastica (kg)', key: 'plasticSaved', align: 'end' },\n  { title: 'Acqua (L)', key: 'waterSaved', align: 'end' },\n  { title: 'Prod. Locali (%)', key: 'localProducts', align: 'end' },\n  { title: 'Prod. Bio (%)', key: 'organicProducts', align: 'end', class: 'd-none d-sm-table-cell' },\n  { title: 'Distanza (km)', key: 'deliveryDistance', align: 'end', class: 'd-none d-md-table-cell' },\n  { title: 'Emissioni (kg CO₂)', key: 'deliveryEmissions', align: 'end', class: 'd-none d-md-table-cell' },\n];\n\n// 6. Azioni e Lifecycle\nconst formatMetric = (value: number, unit: string) => `${unit === '%' ? value.toFixed(1) : value.toLocaleString('it-IT')} ${unit}`;\nconst exportToCSV = () => { /* La tua logica CSV è corretta */ };\nconst exportToPDF = () => alert('Funzionalità PDF in sviluppo');\nconst refreshData = () => { lastUpdate.value = new Date().toLocaleString('it-IT'); };\n\nonMounted(() => {\n  setTimeout(() => {\n    environmentalData.value = [\n      { month: 'Gennaio', year: 2025, co2Saved: 1250, plasticSaved: 320, waterSaved: 5600, localProducts: 85, organicProducts: 62, deliveryDistance: 1200, deliveryEmissions: 180 },\n      { month: 'Febbraio', year: 2025, co2Saved: 1320, plasticSaved: 350, waterSaved: 6100, localProducts: 88, organicProducts: 65, deliveryDistance: 1350, deliveryEmissions: 195 },\n      { month: 'Marzo', year: 2025, co2Saved: 1450, plasticSaved: 380, waterSaved: 6500, localProducts: 90, organicProducts: 70, deliveryDistance: 1400, deliveryEmissions: 210 },\n      { month: 'Aprile', year: 2025, co2Saved: 1380, plasticSaved: 360, waterSaved: 6200, localProducts: 87, organicProducts: 68, deliveryDistance: 1380, deliveryEmissions: 200 },\n      { month: 'Maggio', year: 2025, co2Saved: 1520, plasticSaved: 400, waterSaved: 6800, localProducts: 92, organicProducts: 72, deliveryDistance: 1450, deliveryEmissions: 220 }\n    ];\n    selectedYear.value = 2025;\n    lastUpdate.value = new Date().toLocaleString('it-IT');\n    isLoading.value = false;\n  }, 1000);\n});\n</script>\n\n<template>\n  <v-card>\n    <v-card-item class=\"pa-4 pa-md-6\">\n      <div class=\"d-flex flex-wrap align-center gap-4\">\n        <div>\n          <h2 class=\"text-h5\">Dashboard Impatto Ambientale</h2>\n          <p class=\"text-subtitle-1 text-medium-emphasis\">Metriche di sostenibilità aggregate e mensili</p>\n        </div>\n        <v-spacer></v-spacer>\n        <div class=\"d-flex flex-wrap align-center gap-2\">\n          <v-select v-model=\"selectedYear\" :items=\"years\" label=\"Anno\" density=\"compact\" variant=\"outlined\" hide-details style=\"min-width: 120px;\"></v-select>\n          <v-menu>\n            <template v-slot:activator=\"{ props }\"><v-btn icon=\"mdi-dots-vertical\" v-bind=\"props\"></v-btn></template>\n            <v-list>\n              <v-list-item @click=\"refreshData\" prepend-icon=\"mdi-refresh\">Aggiorna</v-list-item>\n              <v-list-item @click=\"exportToCSV\" prepend-icon=\"mdi-file-delimited\">Esporta CSV</v-list-item>\n            </v-list>\n          </v-menu>\n        </div>\n      </div>\n\n      <v-row class=\"mt-4\">\n        <v-col v-for=\"kpi in kpiTotals\" :key=\"kpi.key\" cols=\"12\" sm=\"6\" md=\"4\" lg=\"3\">\n          <v-card variant=\"tonal\" :color=\"kpi.color\" class=\"pa-3 h-100\">\n            <div class=\"d-flex align-center\">\n              <v-avatar :icon=\"kpi.icon\" :color=\"kpi.color\" variant=\"tonal\" size=\"40\" class=\"me-3\"></v-avatar>\n              <div>\n                <div class=\"text-overline\">{{ kpi.label }}</div>\n                <div class=\"text-h5 font-weight-bold\">{{ formatMetric(kpi.value, kpi.unit) }}</div>\n              </div>\n            </div>\n          </v-card>\n        </v-col>\n      </v-row>\n    </v-card-item>\n\n    <v-divider></v-divider>\n\n    <v-card-title class=\"d-flex align-center\">\n      <h3 class=\"text-h6\">Dettaglio Mensile per l'anno {{ selectedYear }}</h3>\n      <v-spacer></v-spacer>\n      <v-text-field v-model=\"search\" label=\"Cerca mese...\" prepend-inner-icon=\"mdi-magnify\" variant=\"outlined\" density=\"compact\" hide-details style=\"max-width: 250px;\"></v-text-field>\n    </v-card-title>\n    \n    <v-data-table\n      :headers=\"headers\"\n      :items=\"filteredData\"\n      :search=\"search\"\n      :loading=\"isLoading\"\n      item-value=\"month\"\n      class=\"elevation-0\"\n    >\n      <template v-slot:loading><v-skeleton-loader type=\"table-row@5\"></v-skeleton-loader></template>\n\n      <template v-slot:item.co2Saved=\"{ value }\">{{ value.toLocaleString('it-IT') }}</template>\n      <template v-slot:item.plasticSaved=\"{ value }\">{{ value.toLocaleString('it-IT') }}</template>\n      <template v-slot:item.waterSaved=\"{ value }\">{{ value.toLocaleString('it-IT') }}</template>\n      <template v-slot:item.localProducts=\"{ value }\">{{ value }}</template>\n      <template v-slot:item.organicProducts=\"{ value }\">{{ value }}</template>\n      <template v-slot:item.deliveryDistance=\"{ value }\">{{ value.toLocaleString('it-IT') }}</template>\n      <template v-slot:item.deliveryEmissions=\"{ value }\">{{ value.toLocaleString('it-IT') }}</template>\n      \n      <template v-slot:no-data><div class=\"pa-4 text-center\">Nessun dato trovato per l'anno selezionato.</div></template>\n    </v-data-table>\n\n  </v-card>\n</template>\n\n<style scoped>\n.gap-2 { gap: 8px; }\n.gap-4 { gap: 16px; }\n</style>"],"names":[],"mappings":"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"}