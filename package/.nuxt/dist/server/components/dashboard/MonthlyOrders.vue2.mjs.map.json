{"file":"MonthlyOrders.vue2.mjs","mappings":"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","names":[],"sources":["../../../../../components/dashboard/MonthlyOrders.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ref, onMounted, watch, computed } from 'vue';\r\nimport OrderDetailsModal from './OrderDetailsModal.vue';\r\nimport { api } from '~/services/api';\r\n\r\n// 1. Interfaccia TypeScript per una tipizzazione forte\r\ninterface Order {\r\n  id: number;\r\n  status: 'Completato' | 'In elaborazione' | 'Annullato'; // Sii più specifico possibile\r\n  creationDate: string;\r\n  client: string;\r\n  email: string;\r\n  total: number;\r\n  paid: boolean;\r\n  payment: string;\r\n  market: string;\r\n}\r\n\r\n// 2. Stato reattivo (Refs)\r\nconst orders = ref<Order[]>([]);\r\nconst isLoading = ref(true);\r\nconst lastUpdate = ref('');\r\nconst search = ref(''); // Aggiunto per la funzionalità di ricerca\r\nconst errorMessage = ref('');\r\n\r\n// 3. Gestione di data e anno\r\nconst currentYear = new Date().getFullYear();\r\nconst selectedMonth = ref(new Date().getMonth());\r\nconst selectedYear = ref(currentYear);\r\n\r\n// Genera dinamicamente la lista dei mesi e degli anni per i selettori\r\nconst months = Array.from({ length: 12 }, (_, i) => ({ title: new Date(0, i).toLocaleString('it-IT', { month: 'long' }), value: i }));\r\nconst years = Array.from({ length: 10 }, (_, i) => currentYear - 5 + i);\r\n\r\n// 4. Headers per v-data-table (più dichiarativo e pulito)\r\n// Le classi per la responsività sono definite qui\r\nconst headers = [\r\n  { title: 'ID', key: 'id', align: 'start' },\r\n  { title: 'Stato', key: 'status' },\r\n  { title: 'Data', key: 'creationDate', class: 'd-none d-sm-table-cell' },\r\n  { title: 'Cliente', key: 'client' },\r\n  { title: 'Email', key: 'email', class: 'd-none d-md-table-cell' },\r\n  { title: 'Totale', key: 'total', align: 'end' },\r\n  { title: 'Pagato', key: 'paid', align: 'center', class: 'd-none d-md-table-cell' },\r\n  { title: 'Pagamento', key: 'payment', class: 'd-none d-lg-table-cell' },\r\n  { title: 'Mercato', key: 'market', class: 'd-none d-lg-table-cell' },\r\n  { title: 'Azioni', key: 'actions', align: 'center', sortable: false },\r\n];\r\n\r\n// 5. Logica API\r\nconst loadOrders = async () => {\r\n  isLoading.value = true;\r\n  errorMessage.value = '';\r\n  try {\r\n    const monthStr = String(selectedMonth.value + 1).padStart(2, '0');\r\n    const response = await api.getMonthlyOrders(monthStr, String(selectedYear.value));\r\n    orders.value = response.orders || [];\r\n    lastUpdate.value = response.lastUpdate || new Date().toLocaleString('it-IT');\r\n  } catch (error) {\r\n    console.error('Errore nel caricamento degli ordini:', error);\r\n    errorMessage.value = 'Impossibile caricare i dati. Verifica la connessione.';\r\n    orders.value = [];\r\n  } finally {\r\n    isLoading.value = false;\r\n  }\r\n};\r\n\r\n// 6. Gestione Modale (invariata)\r\nconst showModal = ref(false);\r\nconst selectedOrder = ref<Order | null>(null);\r\n\r\nconst viewOrderDetails = (order: Order) => {\r\n  selectedOrder.value = order;\r\n  showModal.value = true;\r\n};\r\nconst closeModal = () => showModal.value = false;\r\n\r\n// 7. Funzioni di Utilità e Azioni\r\nconst getStatusColor = (status: Order['status']) => {\r\n  if (status === 'Completato') return 'success';\r\n  if (status === 'In elaborazione') return 'warning';\r\n  return 'error';\r\n};\r\n\r\nconst formatCurrency = (value: number) => {\r\n    return new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR' }).format(value);\r\n};\r\n\r\nconst exportCSV = () => { /* La tua logica CSV va bene, nessun cambiamento necessario */ };\r\nconst exportPDF = () => alert('Funzionalità di esportazione PDF in fase di implementazione');\r\nconst refreshData = () => loadOrders();\r\n\r\n// 8. Watchers e Lifecycle Hooks\r\nwatch([selectedMonth, selectedYear], loadOrders);\r\nonMounted(loadOrders);\r\n</script>\r\n\r\n<template>\r\n  <v-card elevation=\"10\">\r\n    <v-card-title class=\"d-flex flex-wrap align-center pa-4\">\r\n      <div class=\"me-4\">\r\n        <h5 class=\"text-h5\">Resoconto Ordini</h5>\r\n        <v-card-subtitle class=\"ps-0\">Ultimo aggiornamento: {{ lastUpdate }}</v-card-subtitle>\r\n      </div>\r\n      <v-spacer></v-spacer>\r\n      <div class=\"d-flex align-center flex-wrap gap-2\" style=\"width: 100%; max-width: 600px;\">\r\n        <v-select\r\n          v-model=\"selectedMonth\"\r\n          :items=\"months\"\r\n          label=\"Mese\"\r\n          hide-details\r\n          variant=\"outlined\"\r\n          density=\"compact\"\r\n          class=\"flex-grow-1\"\r\n          style=\"min-width: 140px;\"\r\n        ></v-select>\r\n        <v-select\r\n          v-model=\"selectedYear\"\r\n          :items=\"years\"\r\n          label=\"Anno\"\r\n          hide-details\r\n          variant=\"outlined\"\r\n          density=\"compact\"\r\n          class=\"flex-grow-1\"\r\n          style=\"min-width: 120px;\"\r\n        ></v-select>\r\n        <v-btn icon=\"mdi-refresh\" @click=\"refreshData\" title=\"Aggiorna dati\"></v-btn>\r\n        <v-menu>\r\n          <template v-slot:activator=\"{ props }\">\r\n            <v-btn icon=\"mdi-download\" v-bind=\"props\" title=\"Esporta dati\"></v-btn>\r\n          </template>\r\n          <v-list>\r\n            <v-list-item @click=\"exportCSV\">\r\n              <v-list-item-title><v-icon start>mdi-file-delimited</v-icon>Esporta CSV</v-list-item-title>\r\n            </v-list-item>\r\n            <v-list-item @click=\"exportPDF\">\r\n              <v-list-item-title><v-icon start>mdi-file-pdf-box</v-icon>Esporta PDF</v-list-item-title>\r\n            </v-list-item>\r\n          </v-list>\r\n        </v-menu>\r\n      </div>\r\n    </v-card-title>\r\n    \r\n    <v-divider></v-divider>\r\n\r\n    <v-text-field\r\n      v-model=\"search\"\r\n      label=\"Cerca in tabella (cliente, email, stato...)\"\r\n      prepend-inner-icon=\"mdi-magnify\"\r\n      variant=\"solo-filled\"\r\n      flat\r\n      hide-details\r\n      single-line\r\n      class=\"pa-2\"\r\n    ></v-text-field>\r\n\r\n    <v-alert v-if=\"errorMessage\" type=\"error\" class=\"ma-2\" density=\"compact\" closable>\r\n      {{ errorMessage }}\r\n    </v-alert>\r\n\r\n    <v-data-table\r\n      :headers=\"headers\"\r\n      :items=\"orders\"\r\n      :search=\"search\"\r\n      :loading=\"isLoading\"\r\n      item-value=\"id\"\r\n      class=\"elevation-0\"\r\n    >\r\n      <template v-slot:loading>\r\n        <v-skeleton-loader type=\"table-row@5\"></v-skeleton-loader>\r\n      </template>\r\n      \r\n      <template v-slot:item.status=\"{ value }\">\r\n        <v-chip :color=\"getStatusColor(value)\" size=\"small\">{{ value }}</v-chip>\r\n      </template>\r\n\r\n      <template v-slot:item.total=\"{ value }\">\r\n        {{ formatCurrency(value) }}\r\n      </template>\r\n      \r\n      <template v-slot:item.paid=\"{ value }\">\r\n        <v-icon :color=\"value ? 'success' : 'error'\">\r\n          {{ value ? 'mdi-check-circle' : 'mdi-close-circle' }}\r\n        </v-icon>\r\n      </template>\r\n\r\n      <template v-slot:item.actions=\"{ item }\">\r\n        <v-btn icon=\"mdi-eye\" variant=\"text\" color=\"primary\" size=\"small\" @click=\"viewOrderDetails(item)\"></v-btn>\r\n      </template>\r\n      \r\n      <template v-slot:no-data>\r\n        <div class=\"pa-4 text-center\">Nessun ordine trovato per il periodo selezionato.</div>\r\n      </template>\r\n\r\n    </v-data-table>\r\n\r\n    <OrderDetailsModal \r\n      :order=\"selectedOrder\" \r\n      :show=\"showModal\" \r\n      @close=\"closeModal\" \r\n      v-if=\"selectedOrder\"\r\n    />\r\n  </v-card>\r\n</template>\r\n\r\n<style scoped>\r\n/* Stili per rendere i gap tra elementi flessibili */\r\n.gap-2 {\r\n  gap: 8px;\r\n}\r\n</style>"],"version":3}