{"version":3,"file":"RiderDeliveries.vue2.mjs","sources":["../../../../../components/dashboard/RiderDeliveries.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue';\n\n// 1. Definiamo le interfacce TypeScript per una tipizzazione robusta\ninterface DeliveryMonth {\n  month: string;\n  count: number;\n  onTime: number;\n  late: number;\n}\n\ninterface Rider {\n  id: number;\n  name: string;\n  avatar: string; // Aggiunto avatar per un tocco visivo\n  deliveries: DeliveryMonth[];\n  rating: number;\n  vehicle: string;\n  zone: string;\n}\n\n// Interfaccia per i dati \"appiattiti\" mostrati in tabella\ninterface RiderMonthlyStat extends Omit<Rider, 'deliveries'> {\n  monthlyDeliveries: DeliveryMonth;\n  onTimePercentage: number;\n}\n\n\n// 2. Stato reattivo e dati (con simulazione di caricamento)\nconst isLoading = ref(true);\nconst riders = ref<Rider[]>([]); // Dati originali, ora tipizzati\nconst search = ref(''); // Per la barra di ricerca\nconst lastUpdate = ref('');\nconst selectedMonth = ref('Ottobre'); // Default a Ottobre 2025\n\n// Mesi disponibili per il filtro\nconst months = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];\n\n// 3. Headers per v-data-table: centralizzati e più puliti\nconst headers = [\n  { title: 'Rider', key: 'name', align: 'start' },\n  { title: 'Consegne', key: 'monthlyDeliveries.count', align: 'center' },\n  { title: 'Puntualità', key: 'onTimePercentage', align: 'center' },\n  { title: 'Rating', key: 'rating', align: 'center', class: 'd-none d-md-table-cell' },\n  { title: 'Veicolo', key: 'vehicle', class: 'd-none d-lg-table-cell' },\n  { title: 'Zona', key: 'zone', class: 'd-none d-lg-table-cell' },\n];\n\n// 4. Logica di calcolo (Computed Properties)\nconst filteredData = computed((): RiderMonthlyStat[] => {\n  return riders.value.map(rider => {\n    const monthData = rider.deliveries.find(d => d.month === selectedMonth.value) ||\n                      { month: selectedMonth.value, count: 0, onTime: 0, late: 0 };\n\n    const onTimePercentage = monthData.count > 0 ? (monthData.onTime / monthData.count) * 100 : 0;\n\n    return {\n      ...rider,\n      monthlyDeliveries: monthData,\n      onTimePercentage: onTimePercentage,\n    };\n  }).sort((a, b) => b.monthlyDeliveries.count - a.monthlyDeliveries.count);\n});\n\nconst monthlyTotals = computed(() => {\n  return filteredData.value.reduce((acc, rider) => {\n    acc.totalDeliveries += rider.monthlyDeliveries.count;\n    acc.onTime += rider.monthlyDeliveries.onTime;\n    acc.late += rider.monthlyDeliveries.late;\n    return acc;\n  }, { totalDeliveries: 0, onTime: 0, late: 0 });\n});\n\nconst overallOnTimePercentage = computed(() => {\n  if (monthlyTotals.value.totalDeliveries === 0) return 0;\n  return (monthlyTotals.value.onTime / monthlyTotals.value.totalDeliveries * 100);\n});\n\n// 5. Funzioni di Utilità e Azioni\nconst getPunctualityColor = (percentage: number) => {\n  if (percentage >= 95) return 'success';\n  if (percentage >= 90) return 'primary';\n  return 'warning';\n};\n\nconst getProgressBarColor = (percentage: number) => {\n    if (percentage > 90) return 'success';\n    if (percentage > 75) return 'warning';\n    return 'error';\n};\n\nconst exportToCSV = () => { /* La tua logica CSV va bene */ };\nconst exportToPDF = () => alert('Funzionalità PDF in sviluppo');\nconst refreshData = () => {\n    // In un'app reale, qui richiameresti l'API\n    lastUpdate.value = new Date().toLocaleString('it-IT');\n};\n\n// 6. Lifecycle Hook per simulare il caricamento dati\nonMounted(() => {\n  setTimeout(() => {\n    riders.value = [ // Dati mock spostati qui\n        { id: 1, name: 'Marco Rossi', avatar: 'https://cdn.vuetifyjs.com/images/avatars/avatar-1.png', deliveries: [ { month: 'Ottobre', count: 60, onTime: 58, late: 2 } ], rating: 4.8, vehicle: 'Bicicletta elettrica', zone: 'Milano Centro' },\n        { id: 2, name: 'Giulia Bianchi', avatar: 'https://cdn.vuetifyjs.com/images/avatars/avatar-2.png', deliveries: [ { month: 'Ottobre', count: 50, onTime: 47, late: 3 } ], rating: 4.7, vehicle: 'Scooter elettrico', zone: 'Milano Nord' },\n        { id: 3, name: 'Luca Verdi', avatar: 'https://cdn.vuetifyjs.com/images/avatars/avatar-3.png', deliveries: [ { month: 'Ottobre', count: 65, onTime: 62, late: 3 } ], rating: 4.9, vehicle: 'Bicicletta elettrica', zone: 'Milano Est' },\n        { id: 4, name: 'Sofia Neri', avatar: 'https://cdn.vuetifyjs.com/images/avatars/avatar-4.png', deliveries: [ { month: 'Ottobre', count: 58, onTime: 55, late: 3 } ], rating: 4.6, vehicle: 'Scooter elettrico', zone: 'Milano Sud' },\n        { id: 5, name: 'Alessandro Gialli', avatar: 'https://cdn.vuetifyjs.com/images/avatars/avatar-5.png', deliveries: [ { month: 'Ottobre', count: 60, onTime: 58, late: 2 } ], rating: 4.8, vehicle: 'Bicicletta elettrica', zone: 'Milano Ovest' }\n    ];\n    lastUpdate.value = new Date().toLocaleString('it-IT');\n    isLoading.value = false;\n  }, 1000);\n});\n</script>\n\n<template>\n  <v-card>\n    <v-card-item class=\"pa-4 pa-md-6\">\n      <div class=\"d-flex flex-wrap align-center gap-4\">\n        <div>\n          <h2 class=\"text-h5\">Performance Rider</h2>\n          <p class=\"text-subtitle-1 text-medium-emphasis\">Statistiche mensili delle consegne</p>\n        </div>\n        <v-spacer></v-spacer>\n        <div class=\"d-flex flex-wrap align-center gap-2\">\n          <v-select\n            v-model=\"selectedMonth\"\n            :items=\"months\"\n            label=\"Mese\"\n            density=\"compact\"\n            variant=\"outlined\"\n            hide-details\n            style=\"min-width: 140px;\"\n          ></v-select>\n          <v-btn icon=\"mdi-refresh\" @click=\"refreshData\" title=\"Aggiorna\"></v-btn>\n          <v-menu>\n            <template v-slot:activator=\"{ props }\">\n                <v-btn icon=\"mdi-export-variant\" v-bind=\"props\" title=\"Esporta\"></v-btn>\n            </template>\n            <v-list>\n                <v-list-item @click=\"exportToCSV\" prepend-icon=\"mdi-file-delimited\">Esporta CSV</v-list-item>\n                <v-list-item @click=\"exportToPDF\" prepend-icon=\"mdi-file-pdf-box\">Esporta PDF</v-list-item>\n            </v-list>\n          </v-menu>\n        </div>\n      </div>\n\n      <v-row class=\"mt-4\">\n        <v-col cols=\"12\" sm=\"4\">\n          <v-card variant=\"tonal\" class=\"d-flex flex-column pa-4 text-center h-100\">\n            <v-spacer></v-spacer>\n            <div class=\"text-h4 font-weight-bold\">{{ monthlyTotals.totalDeliveries }}</div>\n            <div class=\"text-body-1\">Consegne Totali</div>\n            <v-spacer></v-spacer>\n          </v-card>\n        </v-col>\n        <v-col cols=\"12\" sm=\"4\">\n          <v-card variant=\"tonal\" color=\"success\" class=\"d-flex flex-column pa-4 text-center h-100\">\n            <v-spacer></v-spacer>\n            <div class=\"text-h4 font-weight-bold\">{{ monthlyTotals.onTime }}</div>\n            <div class=\"text-body-1\">Puntuali</div>\n            <v-spacer></v-spacer>\n          </v-card>\n        </v-col>\n        <v-col cols=\"12\" sm=\"4\">\n          <v-card variant=\"tonal\" class=\"d-flex flex-column pa-4 text-center h-100\">\n            <div class=\"text-h4 font-weight-bold\">{{ overallOnTimePercentage.toFixed(1) }}%</div>\n            <div class=\"text-body-1 mb-2\">Puntualità Globale</div>\n            <v-spacer></v-spacer>\n            <v-progress-linear\n                :model-value=\"overallOnTimePercentage\"\n                :color=\"getProgressBarColor(overallOnTimePercentage)\"\n                height=\"8\"\n                rounded\n                class=\"mt-auto\"\n            ></v-progress-linear>\n          </v-card>\n        </v-col>\n      </v-row>\n      </v-card-item>\n\n    <v-divider></v-divider>\n\n    <v-text-field\n        v-model=\"search\"\n        label=\"Cerca rider per nome, veicolo o zona...\"\n        prepend-inner-icon=\"mdi-magnify\"\n        variant=\"solo-filled\"\n        flat\n        hide-details\n        single-line\n    ></v-text-field>\n\n    <v-data-table\n      :headers=\"headers\"\n      :items=\"filteredData\"\n      :search=\"search\"\n      :loading=\"isLoading\"\n      item-value=\"id\"\n      class=\"elevation-0\"\n    >\n      <template v-slot:loading>\n        <v-skeleton-loader type=\"table-row@5\"></v-skeleton-loader>\n      </template>\n\n      <template v-slot:item.name=\"{ item }\">\n        <div class=\"d-flex align-center pa-2\">\n            <v-avatar :image=\"item.avatar\" size=\"40\" class=\"me-3\"></v-avatar>\n            <div>\n                <div class=\"font-weight-bold\">{{ item.name }}</div>\n                <div class=\"text-caption\">{{ item.id }}</div>\n            </div>\n        </div>\n      </template>\n\n      <template v-slot:item.onTimePercentage=\"{ value }\">\n        <v-chip :color=\"getPunctualityColor(value)\" size=\"small\" class=\"font-weight-bold\">\n          {{ value.toFixed(1) }}%\n        </v-chip>\n      </template>\n\n      <template v-slot:item.rating=\"{ value }\">\n        <v-rating\n          :model-value=\"value\"\n          color=\"amber\"\n          density=\"compact\"\n          size=\"small\"\n          readonly\n          half-increments\n        ></v-rating>\n      </template>\n\n      <template v-slot:no-data>\n        <div class=\"pa-4 text-center\">Nessun dato disponibile per il mese selezionato.</div>\n      </template>\n\n    </v-data-table>\n  </v-card>\n</template>\n\n<style scoped>\n.gap-2 { gap: 8px; }\n.gap-4 { gap: 16px; }\n</style>"],"names":[],"mappings":"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"}